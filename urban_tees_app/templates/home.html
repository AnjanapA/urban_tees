{% extends 'user_layout.html' %}
{% load static %}
{% block content %}
{% include 'category_navbar.html' %}

{% include 'main.html' %}

<div id="cartSidebar"
  style="position: fixed; top: 0; right: -320px; width: 300px; height: 100%; color: white; background-color: rgb(0, 0, 0); box-shadow: -2px 0 5px rgba(0,0,0,0.3); transition: right 0.3s ease; z-index: 1050; padding: 20px;">

  <button id="closeSidebar" class="btn btn-sm btn-outline-secondary"
    style="position: absolute; top: 10px; left: 10px;">Ã—</button>
  <div class="dropdown-menu">

    <h5 class="mb-3">select size and quantity</h5>
    <div id="button-container">
      <button id="toggleButton"
        style="padding: 8px 16px; background-color: white; color: black; border: 1px solid #ccc;"
        onclick="showCounter()">
        S
      </button>
    </div>
    <div class="dropdown-divider"></div>

    <div class="row">
      <div class="col-md-8 text-center">

        <p class="h5 mt-3">

          Total Price
        </p>
      </div>

      <div class="col-md-3 text-center">

        <p class="h5 mt-3">

        <p class="text-dark">{{ item.new_price }}</p>
        </p>
      </div>
    </div>
    <div class="row text-center">
      <a class="btn btn-outline-light me-2" href="" style="background-color: rgb(252, 76, 1);" id="Continue">
        Place Order
      </a>

    </div>

    <div class="dropdown-divider"></div>
    <!-- <a class="dropdown-item"  href="{% url 'web_home' %}">Logout</a> -->
  </div>

  {% endblock %}
  
  {% block script %}
  <script>
    const cartSidebar = document.getElementById('cartSidebar');
    const cartOpenBtn = document.getElementById('cartSlide');
    const cartCloseBtn = document.getElementById('closeSidebar');

    cartOpenBtn.onclick = () => cartSidebar.style.right = '0';
    cartCloseBtn.onclick = () => cartSidebar.style.right = '-320px';

    document.addEventListener('click', function (e) {
      if (!cartSidebar.contains(e.target) && !cartOpenBtn.contains(e.target)) {
        cartSidebar.style.right = '-320px';
      }
    });

    let count = 1;
    const maxCount = 5;
    const minCount = 1;

    function showCounter() {
      const container = document.getElementById('button-container');

      container.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px;">
        <button onclick="decrease()" style="background-color: white; color: black; border: 1px solid #ccc; padding: 5px 10px;">-</button>
        <span id="counterValue" style="min-width: 20px; text-align: center;">${count}</span>
        <button onclick="increase()" style="background-color: white; color: black; border: 1px solid #ccc; padding: 5px 10px;">+</button>
      </div>
    `;
    }

    function increase() {
      if (count < maxCount) {
        count++;
        document.getElementById('counterValue').innerText = count;
      }
    }

    function decrease() {
      if (count > minCount) {
        count--;

        document.getElementById('counterValue').innerText = count;
      }
    }


    $('.action-btn').on('click', function () {
      const action = $(this).data('cart_slide');
      const id = $(this).data('id');

      $.ajax({
        url: '/user_products/cart_slide',
        method: 'POST',
        data: {
          action: cart_slide,
          product_id: id
        },
        success: function (response) {
          alert(response.message);
        },
        error: function () {
          alert("Something went wrong.");
        }
      });
    });
  </script>
  {% endblock %}